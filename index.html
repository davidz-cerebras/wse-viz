<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cerebras Wafer-Scale Engine Visualizer</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Wafer-Scale Engine Visualizer</h1>
        <div class="controls">
          <button id="startBtn">Random</button>
          <button id="allReduceFullBtn">AllReduce</button>
          <button id="spmvBtn">SpMV</button>
          <button id="cgBtn">Conjugate Gradient</button>
          <span class="controls-separator">|</span>
          <label class="file-input-label" for="traceFileInput">
            Load Trace
            <input type="file" id="traceFileInput" accept=".log" hidden />
          </label>
        </div>
      </header>
      <main>
        <div class="canvas-container">
          <canvas id="wseCanvas"></canvas>
        </div>
        <div class="code-panel" id="cgPanel">
          <h2>Conjugate Gradient Algorithm</h2>
          <div class="code-content">
            <div class="code-line" data-line="1">
              <span class="line-number">1</span>
              <span class="line-text">r = b - Ax₀</span>
            </div>
            <div class="code-line" data-line="2">
              <span class="line-number">2</span>
              <span class="line-text">p = r</span>
            </div>
            <div class="code-line" data-line="3">
              <span class="line-number">3</span>
              <span class="line-text">for k = 0 to max_iter-1:</span>
            </div>
            <div class="code-line" data-line="4">
              <span class="line-number">4</span>
              <span class="line-text"> Ap = A × p</span>
            </div>
            <div class="code-line" data-line="5">
              <span class="line-number">5</span>
              <span class="line-text"> α = (rᵀr) / (pᵀAp)</span>
            </div>
            <div class="code-line" data-line="6">
              <span class="line-number">6</span>
              <span class="line-text"> x = x + αp</span>
            </div>
            <div class="code-line" data-line="7">
              <span class="line-number">7</span>
              <span class="line-text"> r = r - αAp</span>
            </div>
            <div class="code-line" data-line="8">
              <span class="line-number">8</span>
              <span class="line-text"> β = (rᵀr) / (rᵀr)₍ₖ₋₁₎</span>
            </div>
            <div class="code-line" data-line="9">
              <span class="line-number">9</span>
              <span class="line-text"> p = r + βp</span>
            </div>
            <div class="code-line" data-line="10">
              <span class="line-number">10</span>
              <span class="line-text"> if ‖r‖ < ε: break</span>
            </div>
          </div>
          <div class="status-panel">
            <h3>Execution Status</h3>
            <div class="status-content">
              <div class="status-item">
                <span class="status-label">Iteration:</span>
                <span class="status-value" id="iterationValue">-</span>
              </div>
              <div class="status-item">
                <span class="status-label">Current Step:</span>
                <span class="status-value" id="stepValue">-</span>
              </div>
              <div class="status-item">
                <span class="status-label">Operation:</span>
                <span class="status-value" id="operationValue">-</span>
              </div>
            </div>
          </div>
        </div>
        <div class="trace-panel" id="tracePanel">
          <h2>Trace Events</h2>
          <div id="traceLog" class="trace-log"></div>
        </div>
      </main>
      <div class="playback-bar" id="playbackBar">
        <button id="playPauseBtn" title="Play/Pause">&#9654;</button>
        <input type="range" id="scrubBar" min="0" max="0" value="0" />
        <span id="cycleDisplay" class="cycle-display"></span>
        <button id="speedDown" class="speed-btn" title="Halve speed">&minus;</button>
        <span id="speedDisplay" class="speed-display">4 cyc/s</span>
        <button id="speedUp" class="speed-btn" title="Double speed">+</button>
      </div>
    </div>
    <script type="module" src="app.js"></script>
  </body>
</html>
